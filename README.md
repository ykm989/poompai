# 🧾 뿜빠이 (Poompai)

함께한 모임, 명확하게 나누는 정산  
**뿜빠이**는 소규모 그룹 모임에서 발생한 공동 지출을 정리하고,  
누가 누구에게 얼마를 송금해야 하는지를 직관적으로 보여주는 **iOS 전용 정산 앱**입니다.

---

## 📱 앱 소개

뿜빠이는 친구나 가족, 동료와의 회식, 여행, 파티 등 다양한 상황에서 생긴 **공동 비용을 쉽고 공정하게 정산**하는 앱입니다.  
복잡한 지출 내역 없이, 참여자와 금액만 입력하면 자동으로 정산이 완료됩니다.

---

## 🔧 주요 기능

- **그룹 생성 및 멤버 등록**  
  모임 단위로 그룹을 만들고, 참여자를 자유롭게 추가할 수 있습니다.

- **지출(Payment) 기록 관리**  
  누가 얼마를 냈고, 누가 해당 비용에 포함되었는지 상세히 입력할 수 있습니다.

- **자동 정산 알고리즘**  
  입력된 지출을 바탕으로, 누구에게 얼마를 송금해야 하는지 자동으로 계산됩니다.

- **정산 내역 리스트 시각화**  
  `A → B: ₩10,000` 형태로 한눈에 정산 흐름을 확인할 수 있습니다.

---

## 🛠️ 사용 기술 및 이유

| 기술 | 설명 및 도입 이유 |
|------|-------------------|
| **UIKit** | iOS 16 이상 사용자에게 최적화된 UI 구성 및 커스텀 뷰 활용을 위해 사용 |
| **Core Data** | 로컬 데이터 영속성 확보 및 관계형 구조 설계 (Group - Payment - Member) |
| **AutoLayout** | 다양한 화면 크기 대응을 위한 유연한 UI 배치 |
| **MVVM 아키텍처** | 뷰와 로직의 분리로 테스트 용이성 및 유지보수성 확보 |
| **Combine** | 사용자 이벤트 및 상태 흐름을 reactive하게 처리하기 위해 일부 적용 |

---

## 🧗 기술적 어려움 및 해결 과정

### 💸 정산 알고리즘 설계의 기술적 어려움

**뿜빠이**에서 가장 핵심적인 기능은, 여러 명이 서로 다른 금액을 지출했을 때  
**누가 누구에게 얼마를 보내야 하는지를 자동으로 계산**해주는 **정산 알고리즘**입니다.  
이 기능은 단순히 모든 사람의 지출을 나눠보는 수준이 아니라, **송금 횟수를 최소화**하고 **복잡하지 않은 흐름으로 표현**하는 것이 핵심 목표였습니다.

#### 🎯 해결하고자 했던 문제

- A가 B와 C 대신 지불했고, C는 다시 B에게 송금해야 하는 상황에서 **불필요한 중복 송금 없이 정산을 단순화**할 수 있어야 했습니다.
- “누가 누구에게 얼마를 줘야 하는가”를 **모든 멤버 간 조합마다 계산하면 O(N²)의 복잡도가 발생**하여 비효율적입니다.
- 정산 방향(누가 주고, 누가 받는지)을 결정하려면, 각 사람의 **순 수지(지출 - 몫)** 를 정확히 계산해야 했습니다.

#### 🧠 접근 방법

- 각 사용자의 총 지출과 전체 인원의 1인당 평균 지출을 계산
- 그 차이를 바탕으로 `+`이면 받을 돈(credit), `-`이면 줄 돈(debt)으로 분류
- **돈을 받아야 하는 사람 리스트**와 **돈을 줘야 하는 사람 리스트**를 만들고,  
  `두 리스트를 앞에서부터 매칭`하며 **정산 플로우(송금 쌍)를 생성**하는 방식으로 구현

이 방식은 일종의 **Greedy + 큐 기반 매칭 알고리즘**으로,  
전체 지불과 수령 간의 균형을 맞추면서 **송금 횟수를 최소화**하고 불필요한 송금을 줄여줍니다.

#### 🔧 구현 중 마주한 문제들

1. **부동소수점 오차로 인해 정산 금액이 0으로 떨어지지 않는 문제**
   - 예: `10000 / 3 = 3333.33...`에서 발생하는 반복소수 오차
   - 해결: 소수점 아래 두 자리까지만 계산하고, 내부적으로는 `Int64`를 사용해 **정수 중심의 정산 로직** 구현

2. **정산 순서가 사용자 입장에서 이해하기 어렵게 나오는 문제**
   - 예: A가 B에게 2000원을 보내고, B가 C에게 다시 보내야 하는 식의 **불필요한 연쇄 구조**
   - 해결: 모든 송금 과정을 **Netting 방식(상쇄 구조)**로 정리하여  
     → "최소한의 거래 횟수" + "가장 직접적인 송금 흐름"을 도출

3. **참여 인원이 많아졌을 때 UI에 시각적으로 표현하는 문제가 발생**
   - 송금 흐름을 보여줄 때, `A → B: 3000원`이 너무 많아질 경우 가독성이 떨어짐
   - 해결: **정산 금액이 0인 경우 표시 생략**, **플로우 카드를 정렬하여 우선순위 부여**, **디자인 간소화**

#### ✅ 결과

- 평균 4~6명의 모임에서도 **송금 횟수 2~3회 이내로 정산을 간소화**할 수 있었고,
- 사용자는 누구에게 얼마를 보내면 되는지를 **한눈에 직관적으로 이해**할 수 있게 되었습니다.
- 성능적으로도 O(N log N) 수준으로 정산 처리가 가능해, 큰 부담 없이 UI에서 실시간으로 갱신할 수 있게 되었습니다.


### **Core Data 관계 모델링 문제**  

Group - Payment - Member 간의 다중 관계에서 `Delete Rule`과 `Optional` 설정을 적절히 조절하지 않으면 삭제 시 충돌이 발생함.  
  → 관계 방향에 따라 `Cascade`, `Nullify` 등을 명확히 구분하고, 양방향 관계 설정을 통해 해결

---

